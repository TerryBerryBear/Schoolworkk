var map = L.map('map').setView([51.505, -0.09], 13);

// Add OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

var markerStart, markerEnd, routeLayer;
const ORS_API_KEY = "YOUR_ORS_API_KEY_HERE";  // Replace with your OpenRouteService API Key

// Function to search for an address and place a marker
function searchLocation(isStart) {
    var address = document.getElementById(isStart ? "start" : "end").value;
    var url = `https://nominatim.openstreetmap.org/search?format=json&q=${address}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                var lat = parseFloat(data[0].lat);
                var lon = parseFloat(data[0].lon);
                
                map.setView([lat, lon], 12);

                if (isStart) {
                    if (markerStart) map.removeLayer(markerStart);
                    markerStart = L.marker([lat, lon]).addTo(map).bindPopup("Start Location").openPopup();
                } else {
                    if (markerEnd) map.removeLayer(markerEnd);
                    markerEnd = L.marker([lat, lon]).addTo(map).bindPopup("Destination").openPopup();
                }
            } else {
                alert("Location not found!");
            }
        })
        .catch(error => console.log("Error:", error));
}

// Function to calculate route
function calculateRoute() {
    if (!markerStart || !markerEnd) {
        alert("Please enter both start and destination addresses.");
        return;
    }

    var startCoords = `${markerStart.getLatLng().lng},${markerStart.getLatLng().lat}`;
    var endCoords = `${markerEnd.getLatLng().lng},${markerEnd.getLatLng().lat}`;
    var routeUrl = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${5b3ce3597851110001cf624830c36be712184a2ab45bf1b985a0d19d}&start=${startCoords}&end=${endCoords}`;

    fetch(routeUrl)
        .then(response => response.json())
        .then(data => {
            if (routeLayer) map.removeLayer(routeLayer); // Remove previous route if exists

            var routeCoords = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
            routeLayer = L.polyline(routeCoords, { color: 'blue', weight: 5 }).addTo(map);
            map.fitBounds(routeLayer.getBounds());
        })
        .catch(error => console.log("Route calculation failed:", error));
}
